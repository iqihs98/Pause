#Pause

## 设计文档（Design Document）

**版本**：v1.0
**状态**：MVP 设计冻结
**平台**：iOS + watchOS
**技术栈**：SwiftUI · WatchConnectivity · HealthKit
**更新时间**：2026-01-24

---

## 1. 项目概述

### 1.1 项目背景

Pause 是一个基于 iPhone 与 Apple Watch 的呼吸冥想应用，通过 **呼吸引导动画 + 实时心率反馈**，帮助用户在短时间内放松身心。

项目目标是在保证体验简洁、低学习成本的前提下，实现 iOS 与 watchOS 的高一致性协同体验。

---

### 1.2 一句话定义

> 一个可以随时开始的呼吸冥想工具，用心率作为正念反馈。

---

### 1.3 目标用户

* Apple Watch 用户
* 有放松、减压、睡前冥想需求的人群
* 偏好“即开即用”，不需要复杂课程体系

---

### 1.4 使用场景

* 工作间隙（3–5 分钟）
* 睡前放松
* 运动后心率恢复

---

## 2. MVP 范围定义

### 2.1 包含功能（Must Have）
* 多种呼吸模式选择
* 呼吸引导动画（吸气 / 屏息 / 呼气）
* 开始 / 暂停 / 倒计时
* Apple Watch 心率采集
* iOS ↔ watchOS 会话同步
* 本地保存呼吸会话结果

---

### 2.2 不包含功能（Out of Scope）

* 用户账号系统
* 云端同步
* 冥想课程体系
* 社交分享功能

---

### 2.3 成功指标（Success Metrics）

* 呼吸会话完成率 ≥ 70%
* iOS ↔ watchOS 同步成功率 ≥ 99%
* 心率数据获取成功率 ≥ 95%

---

## 3. 用户流程设计（User Flow）

### 3.1 Flow A：iPhone 发起呼吸会话（主流程）

1. 用户打开 iOS App
2. 选择呼吸模式
3. 点击「开始呼吸」
4. iOS 创建会话 Session
5. 向 Watch 发送会话开始消息
6. Watch 进入呼吸动画页面
7. Watch 开始采集心率
8. iOS 实时展示心率
9. 会话结束
10. iOS 保存会话记录

**异常处理**

* Watch 未连接 → 提示「仅在手机上进行」
* 心率权限未授权 → 无心率模式继续

---

### 3.2 Flow B：Apple Watch 独立发起

1. 用户在 Watch 上点击开始
2. Watch 创建 Session
3. Watch 同步会话状态给 iOS
4. iOS 被动展示会话进度
5. 会话结束 → 数据回传 iOS

---

### 3.3 Flow C：查看历史记录

1. 用户进入历史页面
2. 查看每次呼吸会话：

   * 时长
   * 呼吸模式
   * 平均 / 最低 / 最高心率

---

## 4. 信息架构（Information Architecture）

### 4.1 iOS App 页面结构

* 首页
  * 呼吸模式
  * 开始呼吸
  * 上次会话摘要
* 呼吸会话页

  * 呼吸动画
  * 倒计时
  * 当前心率
  * 暂停 / 结束
* 历史记录页
* 设置页

  * Health 权限说明
  * Watch 连接状态

---

### 4.2 watchOS App 页面结构

* 呼吸会话页（主界面）

  * 呼吸动画
  * 当前心率
  * 开始 / 暂停
* 简化设置页（可选）

  * 触觉反馈开关

---

## 5. 设备通信协议（WatchConnectivity）

### 5.1 协议设计原则

* 所有消息包含：

  * `sessionId`
  * `timestamp`
  * `version`
* iOS 为最终数据归档端
* Watch 负责实时采集与反馈

---

### 5.2 会话状态同步

```json
{
  "type": "session_state",
  "sessionId": "UUID",
  "timestamp": 1700000000,
  "payload": {
    "state": "started | paused | finished",
    "remainingSeconds": 120
  },
  "version": "1.0"
}
```

---

### 5.3 心率采样（Watch → iOS）

```json
{
  "type": "heart_rate_sample",
  "sessionId": "UUID",
  "timestamp": 1700000005,
  "payload": {
    "bpm": 68
  },
  "version": "1.0"
}
```

---

### 5.4 会话总结

```json
{
  "type": "session_summary",
  "sessionId": "UUID",
  "timestamp": 1700000120,
  "payload": {
    "duration": 180,
    "avgHeartRate": 65,
    "minHeartRate": 60,
    "maxHeartRate": 72
  },
  "version": "1.0"
}
```

---

### 5.5 传输策略

| 数据类型 | 方式               |
| ---- | ---------------- |
| 会话状态 | sendMessage      |
| 心率采样 | sendMessage      |
| 会话总结 | transferUserInfo |

---

## 6. 数据模型设计（Data Model）

### 6.1 呼吸节奏

```swift
struct BreathingPattern {
    let inhale: TimeInterval
    let hold: TimeInterval
    let exhale: TimeInterval
}
```

---

### 6.2 心率采样

```swift
struct HeartRateSample {
    let timestamp: Date
    let bpm: Int
}
```

---

### 6.3 呼吸会话

```swift
struct BreathingSession {
    let id: UUID
    let startTime: Date
    let endTime: Date
    let pattern: BreathingPattern
    let heartRates: [HeartRateSample]

    var averageHeartRate: Double
    var minHeartRate: Int
    var maxHeartRate: Int
}
```

---

### 6.4 存储策略

* Watch：

  * 仅保存临时数据
  * 会话结束立即同步
* iOS：

  * 负责持久化（SwiftData / CoreData / JSON）

---

## 7. 设计冻结说明

* 本文档定义 **MVP 阶段的唯一真实来源（Single Source of Truth）**
* 通信协议与数据模型在 v1.0 阶段冻结
* 后续迭代需新增版本号

---

## 8. 下一步开发计划

1. 实现 Shared BreathingEngine（状态机）
2. iOS 单端呼吸会话跑通
3. watchOS 动画与心率采集
4. 完成双端同步
